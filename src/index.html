<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我是你爹！</title>
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/unreset.css">
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.1.1/css/all.min.css">
    <script src="./js/punycode.js"></script>
    <script src="./js/ToolGood.Words.StringSearch.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/dompurify/2.3.8/purify.min.js"></script>
    <script src="https://cdn.staticfile.org/marked/4.0.17/marked.min.js"></script>
</head>

<body>
    <!-- 需要动态设置的类，先在这里添加以让 Tailwind CSS 编译，这种方法不知道行不行，我看有的样式会用变量 -->
    <div class="dh-tailwind-css-classes-init hidden">
        <!-- default 模板在动态调整 Markdown 图片时用到的样式，其中 lg:max-w-3/5 在配置文件中定制，并且已经试验过了，断点也是要编译的 -->
        <div class="dh-template-default-styles lg:max-w-3/5 mx-auto my-4 object-scale-down"></div>
        <div class="dh-template-test-styles invisible"></div>
    </div>
    <div class="dh-top-screens absolute inset-0 z-50">
        <div class="dh-loading-screen absolute inset-0 bg-yellow-500">
            <div
                class="dh-loading absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 align-middle w-full text-center text-5xl font-bold text-white">
                加载中……</div>
        </div>
        <div class="dh-hint-screen hidden absolute inset-0 bg-yellow-500">
            <div
                class="dh-hint absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 align-middle w-full text-center text-5xl font-bold text-white">
                <div class="dh-loading-hint-title mb-6">
                    格式
                </div>
                <div class="hd-hint-text text-3xl">
                    <a class="dh-hint-link underline" href="https://大儿砸.我是你爹.com">
                        名字.我是你爹.com
                    </a>
                </div>

            </div>
        </div>
        <div class="dh-name-change-screen hidden absolute inset-0 bg-blue-500">
            <div class="dh-name-change absolute p-16 text-9xl text-white">
                <div class="dh-name-change-title mb-16">
                    :(
                </div>
                <div class="dh-name-change-text font-normal text-3xl">
                    你的网页遇到问题，需要换一个名字。
                </div>
            </div>
        </div>
        <div class="dh-operation-screen hidden absolute inset-0 bg-black bg-opacity-50">
            <!-- 需要 overflow-hidden -->
            <div
                class="dh-operation-panel w-5/6 h-4/5 md:w-2/5 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 overflow-hidden rounded-xl bg-white">
                <!-- 添加 z-10 以免被下方绝对定位元素覆盖 -->
                <div
                    class="dh-operation-panel-close absolute right-0 w-12 h-12 flex items-center justify-center z-10 text-3xl text-red-500 hover:text-red-600">
                    <i class="fa-solid fa-xmark"></i>
                </div>
                <div class="dh-operation-section-profile-switch hidden absolute inset-0">
                    <div class="dh-profile-switch w-full h-full flex flex-col flex-nowrap p-6">
                        <div class="dh-profile-switch-title mb-6 text-2xl font-bold">切换档案</div>
                        <!-- 控件区域手动添加 block 类来使元素垂直排列，不使用 flex 因为 flex 在元素多的情况下会使元素 shrink -->
                        <div class="dh-profile-switch-elements flex-grow overflow-y-auto overscroll-contain space-y-4"
                            autocomplete="off" autocomplete="off">
                            <select class="dh-profile-switch-selections block w-64 h-6">
                            </select>
                            <button
                                class="dh-profile-switch-confirm block w-24 h-10 rounded text-white bg-green-500 hover:bg-green-600">确定</button>
                        </div>
                    </div>
                </div>
                <div class="dh-operation-section-profile-edit hidden absolute inset-0">
                    <div class="dh-profile-edit w-full h-full flex flex-col flex-nowrap p-6">
                        <div class="dh-profile-edit-title mb-6 text-2xl font-bold">编辑档案</div>
                        <!-- 控件区域手动添加 block 类来使元素垂直排列，不使用 flex 因为 flex 在元素多的情况下会使元素 shrink -->
                        <div class="dh-profile-edit-elements flex-grow overflow-y-auto overscroll-contain space-y-4">
                            <div class="dh-profile-edit-types-title text-md">操作</div>
                            <select class="dh-profile-edit-types block w-64 h-8" autocomplete="off">
                                <option value="create">新建一份云端档案</option>
                                <option value="update">修改当前云端档案</option>
                                <option value="delete">删除当前云端档案</option>
                            </select>
                            <div class="dh-profile-edit-name-title text-md">子女姓名*</div>
                            <input class="dh-profile-edit-name block w-64 h-8 outline-none border-2 border-gray-500"
                                type="text" autocomplete="off">
                            <div class="dh-profile-edit-daddy-name-title text-md">父亲姓名*</div>
                            <input
                                class="dh-profile-edit-daddy-name block w-64 h-8 outline-none border-2 border-gray-500"
                                type="text" autocomplete="off">
                            <div class="dh-profile-edit-markdown-title text-md">文本（支持 Markdown）*</div>
                            <textarea
                                class="dh-profile-edit-markdown w-64 h-64 resize outline-none border-2 border-gray-500"
                                autocomplete="off"></textarea>
                            <div class="dh-profile-edit-background-title text-md">背景图片</div>
                            <input
                                class="dh-profile-edit-background block w-64 h-8 outline-none border-2 border-gray-500"
                                type="text" autocomplete="off">
                            <div class="dh-profile-edit-avatar-title text-md">子女头像</div>
                            <input class="dh-profile-edit-avatar block w-64 h-8 outline-none border-2 border-gray-500"
                                type="text" autocomplete="off">
                            <div class="dh-profile-edit-daddy-avatar-title text-md">父亲头像</div>
                            <input
                                class="dh-profile-edit-daddy-avatar block w-64 h-8 outline-none border-2 border-gray-500"
                                type="text" autocomplete="off">
                            <div class="dh-profile-edit-cloud-music-id-title text-md">网易云音乐 Id</div>
                            <input
                                class="dh-profile-edit-cloud-music-id block w-64 h-8 outline-none border-2 border-gray-500"
                                type="text" autocomplete="off">
                            <button
                                class="dh-profile-edit-confirm block w-24 h-10 rounded text-white bg-green-500 hover:bg-green-600">确定</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="dh-root absolute inset-0">
        <!-- 以 default 为准 -->
        <!-- break-all：需要模板内所有的长串英文也换行 -->
        <!-- 希望 default 模板占一屏，因此加 overflow-hidden 以防止内容溢出，一屏装不下 -->
        <div
            class="dh-template-default hidden absolute inset-0 break-all overflow-hidden bg-cover bg-center bg-no-repeat bg-fixed bg-white">
            <!-- 最好是通过设置 margin 来调整各项间距，因为 Tailwind CSS 的 space 会影响绝对定位的元素 -->
            <!-- 使用 Tailwind CSS 设计时以小屏优先，大屏加断点 -->
            <div
                class="dh-content absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-5/6 md:w-3/5 h-5/6 md:h-4/5 flex flex-col flex-nowrap">
                <div class="dh-title ml-6 mb-12 text-left text-5xl font-bold">
                    <div class="dh-title-name inline"></div>
                    <div class="dh-title-text inline">，我是你爹！</div>
                </div>
                <!-- card 的 overflow-hidden 不能省，省了就溢出，因为 card 无固定高度，markdown 也无固定高度 -->
                <div
                    class="dh-card flex-grow flex flex-col flex-nowrap px-6 py-6 overflow-hidden rounded-3xl border-2 border-stone-300 shadow-2xl bg-stone-50">
                    <!-- 又包了一层。hidden 和 flex 不能加在同一元素上，因为 Tailwind CSS 的 hidden 实际上是 display: none -->
                    <!-- 现在提供了默认头像，不再使用 hidden -->
                    <div class="dh-avatar-group absolute right-12 -mt-16">
                        <div class="dh-avatars flex flex-nowrap items-center">
                            <div
                                class="dh-avatar w-14 h-14 mr-4 overflow-hidden rounded-md shadow-md border-2 border-stone-300">
                                <!-- 似乎指定了宽高，object-cover 才会工作 -->
                                <img class="dh-avatar-img h-14 w-full object-cover" />
                            </div>
                            <div
                                class="dh-daddy-avatar w-20 h-20 overflow-hidden rounded-md shadow-md border-2 border-stone-300">
                                <img class="dh-daddy-avatar-img h-20 w-full object-cover" />
                            </div>
                        </div>
                    </div>
                    <div class="dh-markdown unreset mb-6 flex-grow overflow-y-auto overscroll-contain">
                    </div>
                    <div class="dh-card-tail flex flex-nowrap justify-between">
                        <div class="dh-functions flex flex-nowrap">
                            <div
                                class="dh-function-btn-switch-profile w-12 h-12 mr-4 flex items-center justify-center text-3xl text-gray-500 hover:text-gray-600">
                                <i class="fa-regular fa-address-card"></i>
                            </div>
                            <div
                                class="dh-function-btn-edit-profile w-12 h-12 mr-4 flex items-center justify-center text-3xl text-gray-500 hover:text-gray-600">
                                <i class="fa-solid fa-user-pen"></i>
                            </div>
                        </div>
                        <div class="dh-daddy text-right flex items-center justify-center text-xl font-bold">
                            <!-- 用 flex 是为了文字垂直居中，但会导致里面两个行内 div 在宽度不足时各自换行，需要用 wrapper 修复 -->
                            <div class="dh-daddy-wrapper">
                                <div class="dh-daddy-text inline">爱你的爸爸，</div>
                                <div class="dh-daddy-name inline"></div>
                            </div>
                        </div>
                        <div class="dh-profile-info absolute right-4 bottom-2 text-right text-xs text-gray-500">
                        </div>
                    </div>
                </div>
            </div>
            <div class="dh-music hidden absolute bottom-0">
            </div>
        </div>
        <div
            class="dh-template-test hidden absolute inset-0 break-all overflow-hidden bg-cover bg-center bg-no-repeat bg-fixed bg-white">
            <!-- 最好是通过设置 margin 来调整各项间距，因为 Tailwind CSS 的 space 会影响绝对定位的元素 -->
            <!-- 使用 Tailwind CSS 设计时以小屏优先，大屏加断点 -->
            <div
                class="dh-content absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-5/6 md:w-3/5 h-5/6 md:h-4/5 flex flex-col flex-nowrap">
                <div class="dh-title ml-6 mb-12 text-left text-5xl font-bold">
                    <div class="dh-title-name inline"></div>
                    <div class="dh-title-text inline">，我是你爹！</div>
                </div>
                <!-- card 的 overflow-hidden 不能省，省了就溢出，因为 card 无固定高度，markdown 也无固定高度 -->
                <div
                    class="dh-card flex-grow flex flex-col flex-nowrap px-6 py-6 overflow-hidden rounded-3xl border-2 border-stone-300 shadow-2xl bg-stone-50">
                    <!-- 又包了一层。hidden 和 flex 不能加在同一元素上，因为 Tailwind CSS 的 hidden 实际上是 display: none -->
                    <!-- 现在提供了默认头像，不再使用 hidden -->
                    <div class="dh-avatar-group absolute right-12 -mt-16">
                        <div class="dh-avatars flex flex-nowrap items-center">
                            <div
                                class="dh-avatar w-14 h-14 mr-4 overflow-hidden rounded-md shadow-md border-2 border-stone-300">
                                <!-- 似乎指定了宽高，object-cover 才会工作 -->
                                <img class="dh-avatar-img h-14 w-full object-cover" />
                            </div>
                            <div
                                class="dh-daddy-avatar w-20 h-20 overflow-hidden rounded-md shadow-md border-2 border-stone-300">
                                <img class="dh-daddy-avatar-img h-20 w-full object-cover" />
                            </div>
                        </div>
                    </div>
                    <div class="dh-markdown unreset mb-6 flex-grow overflow-y-auto overscroll-contain">
                    </div>
                    <div class="dh-card-tail flex flex-nowrap justify-between">
                        <div class="dh-functions flex flex-nowrap">
                            <div
                                class="dh-function-btn-switch-profile w-12 h-12 mr-4 flex items-center justify-center text-3xl text-gray-500 hover:text-gray-600">
                                <i class="fa-regular fa-address-card"></i>
                            </div>
                            <div
                                class="dh-function-btn-edit-profile w-12 h-12 mr-4 flex items-center justify-center text-3xl text-gray-500 hover:text-gray-600">
                                <i class="fa-solid fa-user-pen"></i>
                            </div>
                        </div>
                        <div class="dh-daddy text-right flex items-center justify-center text-xl font-bold">
                            <!-- 用 flex 是为了文字垂直居中，但会导致里面两个行内 div 在宽度不足时各自换行，需要用 wrapper 修复 -->
                            <div class="dh-daddy-wrapper">
                                <div class="dh-daddy-text inline">爱你的爸爸，</div>
                                <div class="dh-daddy-name inline"></div>
                            </div>
                        </div>
                        <div class="dh-profile-info absolute right-4 bottom-2 text-right text-xs text-gray-500">
                        </div>
                    </div>
                </div>
            </div>
            <div class="dh-music hidden absolute bottom-0">
            </div>
        </div>
        <!-- 不加 overflow-hidden 的话，浏览器过窄，文字换行溢出露馅 -->
        <div class="dh-pale absolute inset-0 -z-50 overflow-hidden">
            空白 - 顷刻间，你被抽离原来的维度，马丁内斯的旧影仍在脑际徘徊，但在这里，占据你的是*毫无意义*的空白。
            <br>
            <br>
            你 - “朵拉？”
            <br>
            <br>
            空白 - ……
            <br>
            <br>
            五感发达（视觉） [炼狱：失败] - 除了空白，你什么也看不到。
            <br>
            <br>
            五感发达（听觉） [炼狱：失败] - 除了空白，你什么也听不到。
            <br>
            <br>
            五感发达（嗅觉） [炼狱：失败] - 除了空白，你什么也闻不到。
            <br>
            <br>
            平心定气 [极易：成功] - 除了空白，你什么也*感觉*不到。
            <br>
            <br>
            博学多闻 [中等：成功] - 无色、无味、无特征且坚不可摧、永垂不朽。显然，这是一片*灰域*。
            <br>
            <br>
            见微知著 [中等：成功] - 在久远的过去，开发者泼洒出这片灰域，也许是用于调试，也许是为了一点点乐趣。
            <br>
            <br>
            解锁成就：灰域行者
        </div>
    </div>
    <script>
        console.log('瞅什么瞅，我是你爹！');
        // let hostTmp = 'xn--vjqt50bik1b.xn--6qq986bm4cjwp.com';
        // let hostTmp = '王刚.xn--6qq986bm4cjwp.com';
        // let hostTmp = 'Hollis.我是你爹.com';
        // let hostTmp = 'xn--6qq986bm4cjwp.com';
        let hostTmp = punycode.ToUnicode('xn--v4qp6qz71a.xn--6qq986bm4cjwp.com'); // 大儿砸.我是你爹.com
        // let hostTmp = '大儿.xn--6qq986bm4cjwp.com';
        // let hostTmp = 'aaaaaa.xn--6qq986bm4cjwp.com';
        // let hostTmp = 'bbbbbb.xn--6qq986bm4cjwp.com';
        let hostSplited = hostTmp.split('.');
        // let hostSplited = punycode.ToUnicode(window.location.host).split['.'];
        if (hostSplited.length === 3) {
            let nameStr = hostSplited[0];
            // let namePunycode = hostSplited[0];
            // let nameStr = namePunycode;
            // if (namePunycode.indexOf('xn--') >= 0) {
            //     let idn = new IdnMapping();
            //     nameStr = idn.toUnicode(namePunycode);
            // }
            let bannedWords = ['毛泽东', '周恩来', '刘少奇', '朱德', '彭德怀', '林彪', '刘伯承', '陈毅', '贺龙', '聂荣臻', '徐向前', '罗荣桓', '叶剑英', '李大钊', '陈独秀', '孙中山', '孙文', '孙逸仙', '邓小平', '陈云', '江泽民', '李鹏', '朱镕基', '李瑞环', '尉健行', '李岚清', '胡锦涛', '罗干', '温家宝', '吴邦国', '曾庆红', '贾庆林', '黄菊', '吴官正', '李长春', '吴仪', '回良玉', '曾培炎', '曹刚川', '唐家璇', '华建敏', '陈至立', '张德江', '俞正声', '王乐泉', '刘云山', '王刚', '王兆国', '刘淇', '贺国强', '郭伯雄', '胡耀邦', '王乐泉', '王兆国', '习近平', '李克强', '张高丽', '刘延东', '彭丽媛', '王岐山', '华国锋', '胡耀邦', '习大大', '吴帮国', '无帮国', '无邦国', '无帮过', '瘟家宝', '假庆林', '甲庆林', '假青林', '离长春', '习远平', '袭近平', '李磕墙', '贺过墙', '和锅枪', '胡主席', '习主席', '毛主席'];
            let bannedWordsTr = ['毛澤東', '周恩來', '劉少奇', '朱德', '彭德懷', '林彪', '劉伯承', '陳毅', '賀龍', '聶榮臻', '徐向前', '羅榮桓', '葉劍英', '李大釗', '陳獨秀', '孫中山', '孫文', '孫逸仙', '鄧小平', '陳雲', '江澤民', '李鵬', '朱镕基', '李瑞環', '尉健行', '李嵐清', '胡錦濤', '羅幹', '溫家寶', '吳邦國', '曾慶紅', '賈慶林', '黃菊', '吳官正', '李長春', '吳儀', '回良玉', '曾培炎', '曹剛川', '唐家璇', '華建敏', '陳至立', '張德江', '俞正聲', '王樂泉', '劉雲山', '王剛', '王兆國', '劉淇', '賀國強', '郭伯雄', '胡耀邦', '王樂泉', '王兆國', '習近平', '李克強', '張高麗', '劉延東', '彭麗媛', '王岐山', '華國鋒', '胡耀邦', '習大大', '吳幫國', '無幫國', '無邦國', '無幫過', '瘟家寶', '假慶林', '甲慶林', '假青林', '離長春', '習遠平', '襲近平', '李磕墻', '賀過墻', '和鍋槍', '胡主席', '習主席', '毛主席'];
            bannedWords = bannedWords.concat(bannedWordsTr);
            let search = new StringSearch();
            search.SetKeywords(bannedWords);
            let invalid = search.ContainsAny(nameStr) || nameStr.length > 10;
            if (!invalid) {

                // $('.dh-function-btn-switch-profile').click(() => {
                //     let mk = $('.dh-ta').val();
                //     dhPost({
                //         entry: '/create',
                //         data: JSON.stringify({
                //             name: 'bbbbbb',
                //             daddy: 'sbsbb',
                //             markdown: mk
                //         })
                //     });
                // });
                // $('.dh-btn2').click(() => {
                //     switchProfile();
                // });
                let closeOperationScreen = () => {
                    $('.dh-profile-edit-name').val('');
                    $('.dh-profile-edit-daddy-name').val('');
                    $('.dh-profile-edit-markdown').val('');
                    $('.dh-profile-edit-background').val('');
                    $('.dh-profile-edit-avatar').val('');
                    $('.dh-profile-edit-daddy-avatar').val('');
                    $('.dh-profile-edit-daddy-cloud-music-id').val('');
                    $('.dh-operation-section-profile-switch').addClass('hidden');
                    $('.dh-operation-screen').addClass('hidden');
                    $('.dh-top-screens').addClass('hidden');
                };
                // 操作面板关闭按钮点击事件
                $('.dh-operation-panel-close').click(closeOperationScreen);
                // 切换档案按钮点击事件
                $('.dh-function-btn-switch-profile').click(() => {
                    $('.dh-profile-switch-selections option').remove();
                    for (let i = 0, length = onlineProfiles.length; i < length; i++) {
                        let p = onlineProfiles[i];
                        $('.dh-profile-switch-selections').append(`<option value='${p.id}'>${p.name}，${p.daddy}</option>`);
                    }
                    $('.dh-profile-switch-selections').append(`<option value="local">本地档案</option>`);
                    currentProfile.id ? $('.dh-profile-switch-selections').val(currentProfile.id) : $('.dh-profile-switch-selections').val('local'); // 设置 value 为 id 或 'local' 的一项选中
                    $('.dh-operation-section-profile-switch').removeClass('hidden');
                    $('.dh-operation-screen').removeClass('hidden');
                    $('.dh-top-screens').removeClass('hidden');
                });
                // 切换档案确认事件
                $('.dh-profile-switch-confirm').click(() => {
                    let targetProfileId = $('.dh-profile-switch-selections').val();
                    if (targetProfileId !== 'local') {
                        for (let i = 0, length = onlineProfiles.length; i < length; i++) {
                            let p = onlineProfiles[i];
                            if (p.id === targetProfileId) {
                                switchProfile(p);
                                break;
                            }
                        }
                    } else {
                        switchProfile();
                    }
                    closeOperationScreen();
                });
                // 编辑档案按钮点击事件
                $('.dh-function-btn-edit-profile').click(() => {
                    // if (currentProfile.id) {
                    //     $('.dh-profile-edit-types option[value="update"]').removeAttr('disabled', 'disabled');
                    //     $('.dh-profile-edit-types option[value="delete"]').removeAttr('disabled', 'disabled');
                    // }
                    // else {
                    //     $('.dh-profile-edit-types option[value="update"]').attr('disabled', 'disabled');
                    //     $('.dh-profile-edit-types option[value="delete"]').attr('disabled', 'disabled');
                    // }
                    $('.dh-profile-edit-types').val('create'); // 设置 value 为 'create' 的一项选中
                    $('.dh-operation-section-profile-edit').removeClass('hidden');
                    $('.dh-operation-screen').removeClass('hidden');
                    $('.dh-top-screens').removeClass('hidden');
                });
                // 编辑档案操作类型变更事件
                $('.dh-profile-edit-types').change(() => {
                    let value = $('.dh-profile-edit-types').val();
                    if (value === 'delete') {
                        $('.dh-profile-edit-name-title').addClass('hidden');
                        $('.dh-profile-edit-daddy-name-title').addClass('hidden');
                        $('.dh-profile-edit-markdown-title').addClass('hidden');
                        $('.dh-profile-edit-background-title').addClass('hidden');
                        $('.dh-profile-edit-avatar-title').addClass('hidden');
                        $('.dh-profile-edit-daddy-avatar-title').addClass('hidden');
                        $('.dh-profile-edit-cloud-music-id-title').addClass('hidden');
                        $('.dh-profile-edit-name').addClass('hidden');
                        $('.dh-profile-edit-daddy-name').addClass('hidden');
                        $('.dh-profile-edit-markdown').addClass('hidden');
                        $('.dh-profile-edit-background').addClass('hidden');
                        $('.dh-profile-edit-avatar').addClass('hidden');
                        $('.dh-profile-edit-daddy-avatar').addClass('hidden');
                        $('.dh-profile-edit-cloud-music-id').addClass('hidden');
                    }
                    else {
                        if (value === 'update') {
                            $('.dh-profile-edit-name').val(currentProfile.name);
                            $('.dh-profile-edit-daddy-name').val(currentProfile.daddy);
                            $('.dh-profile-edit-markdown').val(currentProfile.markdown);
                            $('.dh-profile-edit-background').val(currentProfile.background);
                            $('.dh-profile-edit-avatar').val(currentProfile.avatar);
                            $('.dh-profile-edit-daddy-avatar').val(currentProfile.daddyAvatar);
                            $('.dh-profile-edit-cloud-music-id').val(currentProfile.cloudMusicId);
                        } else {
                            $('.dh-profile-edit-name').val('');
                            $('.dh-profile-edit-daddy-name').val('');
                            $('.dh-profile-edit-markdown').val('');
                            $('.dh-profile-edit-background').val('');
                            $('.dh-profile-edit-avatar').val('');
                            $('.dh-profile-edit-daddy-avatar').val('');
                            $('.dh-profile-edit-daddy-cloud-music-id').val('');
                        }
                        $('.dh-profile-edit-name-title').removeClass('hidden');
                        $('.dh-profile-edit-daddy-name-title').removeClass('hidden');
                        $('.dh-profile-edit-markdown-title').removeClass('hidden');
                        $('.dh-profile-edit-background-title').removeClass('hidden');
                        $('.dh-profile-edit-avatar-title').removeClass('hidden');
                        $('.dh-profile-edit-daddy-avatar-title').removeClass('hidden');
                        $('.dh-profile-edit-cloud-music-id-title').removeClass('hidden');
                        $('.dh-profile-edit-name').removeClass('hidden');
                        $('.dh-profile-edit-daddy-name').removeClass('hidden');
                        $('.dh-profile-edit-markdown').removeClass('hidden');
                        $('.dh-profile-edit-background').removeClass('hidden');
                        $('.dh-profile-edit-avatar').removeClass('hidden');
                        $('.dh-profile-edit-daddy-avatar').removeClass('hidden');
                        $('.dh-profile-edit-cloud-music-id').removeClass('hidden');
                    }
                });
                // 切换档案确认事件
                // ……





                // 先随机生成一套数据，然后发送请求，查无此人或出错都使用随机数据
                // 如果没出错，就选择第一个结果（如果有 hash，选择 hash 对应），设置 hash，提供切换功能，也可切换到随机数据
                let randomItem = (array) => {
                    return array[Math.floor((Math.random() * array.length))];
                };
                let getTemplate = (name) => {
                    for (let i = 0, length = templates.length; i < length; i++) {
                        if (name === templates[i].name) {
                            return templates[i];
                        }
                    }
                };
                // 模板资源相关函数
                let initTemplateResource = (name) => {
                    templateResources[`template-${name}-resource`] = {};
                };
                let getTemplateResource = (name, resourceName) => {
                    return templateResources[`template-${name}-resource`][resourceName];
                };
                let setTemplateResource = (name, resourceName, resource) => {
                    templateResources[`template-${name}-resource`][resourceName] = resource;
                };
                let removeTemplateResource = (name, resourceName) => {
                    delete templateResources[`template-${name}-resource`].resourceName;
                };
                let switchProfile = (profile) => {
                    let markdowns = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'];
                    let daddyNames = ['利维亚的杰洛特', '达斯·维达', '布克·德怀特', '伊莱·万斯', '奎托斯', '丁·贾伦', '克利福德·昂格尔'];
                    // 注意，这里 profile 里的 template 为与后端同一，都只是模板名称，需要获取模板对象使用 getTemplate
                    let luckyTemplate = randomItem(templates);
                    let luckyMarkdown = randomItem(markdowns);
                    let luckyDaddy = randomItem(daddyNames);
                    let localProfile = {
                        name: nameStr,
                        daddy: luckyDaddy,
                        markdown: luckyMarkdown,
                        template: luckyTemplate.name
                    };
                    profile = profile || localProfile;
                    // profile.markdown = profile.markdown || localProfile.markdown; 已无必要，现在 markdown 在后端服务中是必须的
                    // profile.template 为空，或找不到对应模板，都会进入这里
                    if (typeof getTemplate(profile.template) === 'undefined') {
                        profile.template = localProfile.template;
                    }
                    if (JSON.stringify(currentProfile) !== '{}') {
                        getTemplate(currentProfile.template).destroy(currentProfile);
                    }
                    getTemplate(profile.template).initialize(profile);
                    $(document).attr('title', profile.name + '，我是你爹！');
                    if (profile.id) {
                        window.location.hash = profile.id;
                    }
                    else {
                        window.location.hash = '';
                    }
                    currentProfile = profile;
                };
                let dhRequest = (options) => {
                    const BASE_URL = 'https://daddyshere.hollisdevhub.com/api/sons';
                    options = options || {};
                    let entry = options.entry || '';
                    let method = options.method || 'GET';
                    let contentType = options.contentType || 'application/json';
                    let data = options.data || {};
                    let success = (result, status, xhr) => {
                        if (result.code === 0) {
                            console.log(`${options.method} ${options.entry} 请求成功：`, JSON.parse(JSON.stringify(result))); // 之后任何对 result 的修改都会影响这里，所以打印的时候“复制”一份来打印原样
                            if (typeof options.success === 'function') {
                                options.success(result.result);
                            }
                            return;
                        }
                        else {
                            console.log(`${options.method} ${options.entry} 请求成功，但返回结果标记异常：`, JSON.parse(JSON.stringify(result)));
                            if (typeof options.fail === 'function') {
                                options.fail(status, result.code, result.msg);
                            }
                        }
                    };
                    let fail = (xhr, status, error) => {
                        console.log(`${options.method} ${options.entry} 请求失败：${status}, `, error);
                        if (typeof options.fail === 'function') {
                            options.fail(status);
                        }
                    };
                    let complete = (xhr, status) => {
                        if (typeof options.complete === 'function') {
                            options.complete();
                        }
                    };
                    $.ajax({
                        url: BASE_URL + entry,
                        type: method,
                        contentType: contentType,
                        data: data,
                        timeout: 5000,
                        beforeSend: () => {
                            console.log(`发送 AJAX 请求：${method} ${entry}，数据：`, data);
                        }
                    }).done(success).fail(fail).always(complete);
                };
                let dhGet = (options) => {
                    options = options || {};
                    options.method = 'GET';
                    dhRequest(options);
                };
                let dhPost = (options) => {
                    options = options || {};
                    options.method = 'POST';
                    dhRequest(options);
                };
                let templateResources = {};
                let templates = [
                    {
                        name: 'default',
                        data: {
                            avatars: [['./imgs/template-default/daddy-1.webp', './imgs/template-default/son-1.webp'], ['./imgs/template-default/daddy-2.png', './imgs/template-default/son-2.jpg']], // default 模板提供默认头像，但模板并非必须提供默认头像。实际上，模板不一定显示头像。switchProfile 仅处理必需的数据，其他数据由模板自己处理
                            backgrounds: ['./imgs/template-default/bg-1.jpg', './imgs/template-default/bg-2.jpg']
                        },
                        initialize: function (profile) {
                            // 用匿名函数的话，this 就指向 window 而不是模板对象了
                            console.log(`${profile.template} 模板初始化。`);
                            $(`.dh-template-${profile.template} .dh-title-name`).text(profile.name);
                            let daddyCensored = search.Replace(profile.daddy, '❤️');
                            $(`.dh-template-${profile.template} .dh-daddy-name`).text(daddyCensored);
                            let luckyAvatar = randomItem(this.data.avatars);
                            if (profile.daddyAvatar) {
                                $(`.dh-template-${profile.template} .dh-daddy-avatar-img`).attr('src', profile.daddyAvatar);
                            }
                            else {
                                $(`.dh-template-${profile.template} .dh-daddy-avatar-img`).attr('src', luckyAvatar[0]);
                            }
                            if (profile.avatar) {
                                $(`.dh-template-${profile.template} .dh-avatar-img`).attr('src', profile.avatar);
                            }
                            else {
                                $(`.dh-template-${profile.template} .dh-avatar-img`).attr('src', luckyAvatar[1]);
                            }
                            let luckyBackground = randomItem(this.data.backgrounds);
                            if (profile.background) {
                                $(`.dh-template-${profile.template}`).css('background-image', `url(${profile.background})`);
                            }
                            else {
                                $(`.dh-template-${profile.template}`).css('background-image', `url(${luckyBackground})`);
                            }
                            let markdownCensored = search.Replace(profile.markdown, '❤️');
                            $(`.dh-template-${profile.template} .dh-markdown`).html(DOMPurify.sanitize(marked.parse(markdownCensored)));
                            $(`.dh-template-${profile.template} .dh-markdown img`).addClass('mx-auto my-4 lg:max-w-3/5 object-scale-down');
                            if (profile.cloudMusicId) {
                                $(`.dh-template-${profile.template} .dh-music`).html(`<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=298 height=52 src="//music.163.com/outchain/player?type=2&id=${profile.cloudMusicId}&auto=1&height=32"></iframe>`);
                                $(`.dh-template-${profile.template} .dh-music`).removeClass('hidden');
                            }
                            if (profile.expiration) {
                                profile.reserved ? $(`.dh-template-${profile.template} .dh-profile-info`).text('网友定制，长期保存。') : $(`.dh-template-${profile.template} .dh-profile-info`).text(`网友定制，将于 ${profile.expiration.split('T')[0]} 过期。`);
                            }
                            else {
                                $(`.dh-template-${profile.template} .dh-profile-info`).text('本地档案，即时生成。');
                            }
                            $(`.dh-template-${profile.template}`).removeClass('hidden');
                            console.log(`${profile.template} 模板初始化完成。`);
                        },
                        destroy: function (profile) {
                            console.log(`${profile.template} 模板注销。`);
                            $(`.dh-template-${profile.template} .dh-title-name`).text('');
                            $(`.dh-template-${profile.template} .dh-daddy-name`).text('');
                            $(`.dh-template-${profile.template} .dh-avatar-img`).attr('src', '');
                            $(`.dh-template-${profile.template} .dh-daddy-avatar-img`).attr('src', '');
                            $(`.dh-template-${profile.template} .dh-markdown`).html('');
                            $(`.dh-template-${profile.template} .dh-music`).html('');
                            $(`.dh-template-${profile.template} .dh-music`).addClass('hidden');
                            $(`.dh-template-${profile.template} .dh-profile-info`).text('');
                            $(`.dh-template-${profile.template}`).addClass('hidden');
                            console.log(`${profile.template} 模板注销完成。`);
                        }
                    },
                    {
                        name: 'test',
                        data: {
                            avatars: [['./imgs/template-default/daddy-1.webp', './imgs/template-default/son-1.webp'], ['./imgs/template-default/daddy-2.png', './imgs/template-default/son-2.jpg']], // default 模板提供默认头像，但模板并非必须提供默认头像。实际上，模板不一定显示头像。switchProfile 仅处理必需的数据，其他数据由模板自己处理
                            backgrounds: ['./imgs/template-default/bg-1.jpg', './imgs/template-default/bg-2.jpg']
                        },
                        initialize: function (profile) {
                            console.log(`${profile.template} 模板初始化。`);
                            $(`.dh-template-${profile.template} .dh-title-name`).text(profile.name);
                            let daddyCensored = search.Replace(profile.daddy, '❤️');
                            $(`.dh-template-${profile.template} .dh-daddy-name`).text(daddyCensored);
                            let luckyAvatar = randomItem(this.data.avatars);
                            if (profile.daddyAvatar) {
                                $(`.dh-template-${profile.template} .dh-daddy-avatar-img`).attr('src', profile.daddyAvatar);
                            }
                            else {
                                $(`.dh-template-${profile.template} .dh-daddy-avatar-img`).attr('src', luckyAvatar[0]);
                            }
                            if (profile.avatar) {
                                $(`.dh-template-${profile.template} .dh-avatar-img`).attr('src', profile.avatar);
                            }
                            else {
                                $(`.dh-template-${profile.template} .dh-avatar-img`).attr('src', luckyAvatar[1]);
                            }
                            let luckyBackground = randomItem(this.data.backgrounds);
                            if (profile.background) {
                                $(`.dh-template-${profile.template}`).css('background-image', `url(${profile.background})`);
                            }
                            else {
                                $(`.dh-template-${profile.template}`).css('background-image', `url(${luckyBackground})`);
                            }
                            let markdownCensored = search.Replace(profile.markdown, '❤️');
                            $(`.dh-template-${profile.template} .dh-markdown`).html(DOMPurify.sanitize(marked.parse(markdownCensored)));
                            $(`.dh-template-${profile.template} .dh-markdown img`).addClass('mx-auto my-4 lg:max-w-3/5 object-scale-down');
                            if (profile.cloudMusicId) {
                                $(`.dh-template-${profile.template} .dh-music`).html(`<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=298 height=52 src="//music.163.com/outchain/player?type=2&id=${profile.cloudMusicId}&auto=1&height=32"></iframe>`);
                                $(`.dh-template-${profile.template} .dh-music`).removeClass('hidden');
                            }
                            if (profile.expiration) {
                                profile.reserved ? $(`.dh-template-${profile.template} .dh-profile-info`).text('网友定制，长期保存。') : $(`.dh-template-${profile.template} .dh-profile-info`).text(`网友定制，将于 ${profile.expiration.split('T')[0]} 过期。`);
                            }
                            else {
                                $(`.dh-template-${profile.template} .dh-profile-info`).text('本地档案，即时生成。');
                            }
                            initTemplateResource(`${profile.template}`);
                            let interval = setInterval(() => {
                                $(`.dh-template-${profile.template} .dh-title`).hasClass('invisible') ? $(`.dh-template-${profile.template} .dh-title`).removeClass('invisible') : $(`.dh-template-${profile.template} .dh-title`).addClass('invisible');
                            }, 1000);
                            setTemplateResource(`${profile.template}`, 'blink', interval);
                            $(`.dh-template-${profile.template}`).removeClass('hidden');
                            console.log(`${profile.template} 模板初始化完成。`);
                        },
                        destroy: function (profile) {
                            console.log(`${profile.template} 模板注销。`);
                            // 也许应该确保先清空 interval 再操作元素，假如没清空 interval 还删除了元素，interval 内留了个引用，会有内存泄漏吧？
                            // 当然也不是说现在一定就没有，我不是程序员，我啥也不懂
                            let interval = getTemplateResource(`${profile.template}`, 'blink');
                            clearInterval(interval);
                            removeTemplateResource(`${profile.template}`, 'blink');
                            $(`.dh-template-${profile.template} .dh-title-name`).text('');
                            $(`.dh-template-${profile.template} .dh-daddy-name`).text('');
                            $(`.dh-template-${profile.template} .dh-avatar-img`).attr('src', '');
                            $(`.dh-template-${profile.template} .dh-daddy-avatar-img`).attr('src', '');
                            $(`.dh-template-${profile.template} .dh-markdown`).html('');
                            $(`.dh-template-${profile.template} .dh-music`).html('');
                            $(`.dh-template-${profile.template} .dh-music`).addClass('hidden');
                            $(`.dh-template-${profile.template} .dh-profile-info`).text('');
                            $(`.dh-template-${profile.template}`).addClass('hidden');
                            console.log(`${profile.template} 模板注销完成。`);
                        }
                    }
                ];
                let currentProfile = {};
                let onlineProfiles = [];
                dhGet({
                    entry: `/get-by-name/${nameStr}`,
                    success: (res) => {
                        onlineProfiles = res;
                        let hashId = window.location.hash.replace('#', '');
                        if (hashId !== '') {
                            for (let i = 0, length = res.length; i < length; i++) {
                                if (hashId === res[i].id) {
                                    switchProfile(res[i]);
                                    return;
                                }
                            }
                        }
                        switchProfile(res[0]);
                    },
                    fail: () => { switchProfile(); },
                    complete: () => {
                        $('.dh-loading-screen').addClass('hidden');
                        $('.dh-top-screens').addClass('hidden'); // 直接隐藏掉顶层屏幕，不然顶层屏幕绝对定位，点击无法穿透
                    }
                });
            } else {
                $('.dh-loading-screen').addClass('hidden');
                $('.dh-name-change-screen').removeClass('hidden');
            }
        } else {
            $('.dh-loading-screen').addClass('hidden');
            $('.dh-hint-screen').removeClass('hidden');
        }
    </script>
</body>

</html>